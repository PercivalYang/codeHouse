- [模型分层](#模型分层)
  - [总览](#总览)
  - [数据链路层](#数据链路层)
    - [封装成帧](#封装成帧)
    - [差错检测](#差错检测)
    - [可靠性传输](#可靠性传输)
    - [媒体接入控制MAC](#媒体接入控制mac)
  - [网络层](#网络层)
    - [IP地址](#ip地址)
    - [ARP协议](#arp协议)

# 模型分层

## 总览

![20230418155142](https://raw.githubusercontent.com/PercivalYang/imgsSaving/main/imgs/20230418155142.png)

- 最原始的OSI模型是7层，不展开说。目前比较流行的是如图所示的4层模型，以及将数据链路层和物理层单独分开的5层模型。
- 右边的灰色框内是各层的代表协议

## 数据链路层

### 封装成帧

- `透明传输`：即对上层交付的数据没有任何限制（例如不限制不能出现与帧头帧尾相同的字节码，因为在封装前会对其进行转译）
- 帧头帧尾中包含了重要的控制信息，见下方帧格式
- `MTU(Maximum Transmission Unit)`：最大传输单元，即帧的最大长度

**帧格式**

![20230418145943](https://raw.githubusercontent.com/PercivalYang/imgsSaving/main/imgs/20230418145943.png)

- 帧头主要是`标志字段`和`协议字段`
- 帧尾主要是`CRC校验位字段`

### 差错检测

- 奇偶校验：存在漏检
- 循环冗余校验CRC(Cyclic Redundancy Check)：漏检概率小，广泛采用

### 可靠性传输

差错检测后对于错误的帧会进行重传或者丢弃，取决于是否提供可靠传输服务，例如：

- TCP和UDP
- IP向上层提供不可靠、无连接的服务
- 802.11无线局域网要求可靠传输；以太网不要求。（因为有线链路误码率较低，无线较高）

**实现机制**：

1. SW(Stop-and-Wait)停止等待协议：即发送方在发送一组数据后会等待接收方回复`ACK`标志后，在发送下一组数据。
   - 存在信道利用率低的缺点；

2. 回退N帧协议GBN(Go-Back-N)：即发送方连续发送数据分组，对数据分组进行编号；接收方会对应数组编号给`ACK`标志也加上编号，表示该编号的数据组无差错接收成功。当接收方之前发送的某个分组的数据触发`超时重传`后，发送方会将该编号之后的所有分组重新发送。这也是GBN的由来，涉及到的一些名词如下：
   - 滑动窗口(接收方窗口尺寸等于1，即按序接收)
   - 累计确认/捎带确认

3. 选择重传协议SR：在GBN之上提高了效率，接收方的窗口尺寸大于1，接收落在窗口内的发送方无差错数据分组，对于缺失的数据分组会触发发送方的超时重传。
   - 相比GBN，SR合理利用发送过来的数据分组，不再有`头个分组出错而丢弃剩下全部分组`的效率低下问题；
   - 要注意发送方和接收方的窗口尺寸大于分组序号的一半，不然会出现`新旧组无法分辨`问题

### 媒体接入控制MAC

MAC：Medium Access Control

![20230418151318](https://raw.githubusercontent.com/PercivalYang/imgsSaving/main/imgs/20230418151318.png)

**CSMA/CD**：

因为同个网络内多个节点会访问同个共享信道进行通信，为了避免多个节点同时向信道发送数据帧导致`帧碰撞`，于是就有了`CSMA/CD`

- `CSMA`可分为CS和MA进行理解
  - `CS`：Carrier Sense，载波侦听，即检测信道是否空闲
  - `MA`：Multiple Access，多路访问，即多个节点同时访问信道
- `CD`：碰撞检测，即节点边发送数据帧边检测是否发生碰撞

MAC地址：硬件地址

`单播`和`多播地址`：单播地址是指一个节点的MAC地址，多播地址是指一组节点的MAC地址

`广播帧`：目的地址为`FF:FF:FF:FF:FF:FF`的帧，广播帧会被所有节点接收

## 网络层

### IP地址

- 网络号(待完善)
- 主机号(待完善)

### ARP协议

ARP协议帮助从ip地址转换为MAC地址，即`IP地址解析协议`。每个主机都会有一个`ARP高速缓存表`如下，用来查询ip地址和MAC地址之间的映射关系。

![20230418154344](https://raw.githubusercontent.com/PercivalYang/imgsSaving/main/imgs/20230418154344.png)

- 动态是主机运行期间通过广播自动获取的，存在生命周期；
- 静态是手动配置，即持久化存储在硬盘中。

> ARP协议不能跨网络使用，只能在同一网络内使用

`ARP请求报文(广播)`：内容抽象如下，在网络内发送广播帧来查询目标ip地址的MAC地址

![20230418154123](https://raw.githubusercontent.com/PercivalYang/imgsSaving/main/imgs/20230418154123.png)
